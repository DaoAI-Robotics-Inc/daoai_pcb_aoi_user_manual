PCB 拼版
================

本章介绍 PCB 拼版功能，包括拼版新建方式、参数继承与同步、条码检测工具、判废板阈值设置等。

拼版新建流程
-----------------

1. 切换至PCB拼版视图

    在产品详情页，点击右上角的“拼版”按钮，进入拼版管理界面。

    .. image:: images/pcb_array_1.png
        :scale: 50%
        :alt: 拼版入口示意

    点击创建拼版单元，然后鼠标框选绘制主板区域。

    .. image:: images/pcb_array_2.png
        :scale: 50%
        :alt: 拼版主板绘制示意

1. 手动新建：
    - 可以点击列表中的 “添加图标” 逐个添加子板，然后切换至选择工具，用鼠标拖拽调整位置。
    - 适用于不规则或特殊拼版场景。

2. 智能工具辅助：
    .. image:: images/pcb_array_3.png
        :scale: 50%
        :alt: 拼版智能工具示意

    - 依次选择 3 个在子板中相对位置固定的圆形特征作为锚点，分别选取左上角、右上角和左下角子板上的锚点，以确保阵列自动生成时定位准确。
    - 输入子板尺寸、行列数、间距等参数，此时可以看到预览效果。
    - 点击创建拼版，即可完成创建，并回到模板编辑器视图。

当需要删除一个拼版单元时，鼠标悬停至目标子板列表边的 ··· , 点击删除即可。

    .. image:: images/pcb_array_del.png
        :scale: 50%
        :alt: 删除拼版单元示意

参数继承与同步原则
----------------------

* 默认情况下，所有子板的检测参数（如 ROI、阈值、检测项）均继承主板设置，并且子板上的检测框不可编辑

* 通过“同步 ROI”选项：
    .. image:: images/pcb_array_sync_roi.png
       :scale: 50%
       :alt: 同步 ROI 设置示意

    - （默认开启）开启时，主板调整会同步到所有子板。
    - 关闭后，可在每个子板单独调整该元件的 ROI，适用于局部差异或特殊需求。

* 数据管理：
    - 数据集自动按元件分组，统计所有子板的检测结果。

条形码检测工具
-------------------

* 支持在拼版场景下识别每个子板的序列号、批次号等条码信息。


* 操作流程：
    1. 在模板编辑器中，先为主板添加条形码检测框，并分组为新元件。
    2. 创建拼版后，系统会自动将该条形码检测框复制到所有子板。
    3. 检测时，系统可分别识别每个子板上的条码内容，并自动作为序列号归档。

* 应用场景：追溯生产批次、定位异常子板、自动分组统计。

判废板阈值设置

* 可在系统配置中为拼版设置整体判废板阈值。参考 :ref:`系统JSON配置`，编辑 wasted_array_board_failure_ratio 参数并保存。
* 检测过程中，若任一子板的元件 NG 率超过该阈值，则该子板会被判定为废板并报出。



